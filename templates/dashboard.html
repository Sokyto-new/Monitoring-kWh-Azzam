{% extends "layout.html" %}

{% block title %}Dashboard - IoT Energy Monitor{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
{% endblock %}

{% block content %}
<div class="dashboard">
    <div class="dashboard-header">
        <h1><i class="fas fa-tachometer-alt"></i> Dashboard (Masih Belum Berfungsi)</h1>
        <p class="welcome-text">Welcome back, {{ current_user.username }}!</p>
    </div>
    
    <!-- Summary Cards -->
    <div class="summary-cards">
        <div class="summary-card card-blue">
            <div class="card-icon">
                <i class="fas fa-microchip"></i>
            </div>
            <div class="card-content">
                <h3>{{ summary.total_devices or 0 }}</h3>
                <p>Total Devices</p>
            </div>
        </div>
        
        <div class="summary-card card-green">
            <div class="card-icon">
                <i class="fas fa-bolt"></i>
            </div>
            <div class="card-content">
                <h3>{{ "%.2f"|format(summary.total_energy or 0) }} kWh</h3>
                <p>Total Energy</p>
            </div>
        </div>
        
        <div class="summary-card card-orange">
            <div class="card-icon">
                <i class="fas fa-money-bill-wave"></i>
            </div>
            <div class="card-content">
                <h3>Rp {{ "{:,.0f}".format(summary.total_cost or 0) }}</h3>
                <p>Total Cost</p>
            </div>
        </div>
        
        <div class="summary-card card-purple">
            <div class="card-icon">
                <i class="fas fa-chart-line"></i>
            </div>
            <div class="card-content">
                <h3>{{ summary.total_sessions or 0 }}</h3>
                <p>Monitoring Sessions</p>
            </div>
        </div>
    </div>
    
    <!-- Devices Section -->
    <div class="dashboard-section">
        <div class="section-header">
            <h2><i class="fas fa-microchip"></i> My Devices</h2>
            <a href="{{ url_for('devices') }}" class="view-all">View All</a>
        </div>
        
        <div class="devices-grid">
            {% for device in devices %}
            <div class="device-card">
                <div class="device-header">
                    <div class="device-status {% if device.is_online %}online{% else %}offline{% endif %}">
                        <i class="fas fa-circle"></i>
                        {{ 'Online' if device.is_online else 'Offline' }}
                    </div>
                    <div class="device-actions">
                        <button class="action-btn" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                <div class="device-body">
                    <h3>{{ device.device_name }}</h3>
                    <p class="device-location">
                        <i class="fas fa-map-marker-alt"></i> {{ device.location }}
                    </p>
                    <p class="device-type">
                        <i class="fas fa-tag"></i> {{ device.device_type|title }}
                    </p>
                    <p class="device-power">
                        <i class="fas fa-bolt"></i> {{ device.power_rating_w }}W
                    </p>
                </div>
                <div class="device-footer">
                    <div class="device-stats">
                        <span><i class="fas fa-play-circle"></i> {{ device.session_count or 0 }}</span>
                        <span><i class="fas fa-database"></i> {{ device.log_count or 0 }}</span>
                    </div>
                    <a href="{{ url_for('monitoring') }}?device={{ device.device_id }}" 
                       class="monitor-btn">
                        <i class="fas fa-play"></i> Monitor
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    
    <!-- Recent Sessions -->
    <div class="dashboard-section">
        <div class="section-header">
            <h2><i class="fas fa-history"></i> Recent Monitoring Sessions</h2>
            <a href="{{ url_for('logs') }}" class="view-all">View All</a>
        </div>
        
        <div class="sessions-table">
            <table>
                <thead>
                    <tr>
                        <th>Session</th>
                        <th>Device</th>
                        <th>Start Time</th>
                        <th>Duration</th>
                        <th>Energy</th>
                        <th>Cost</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for session in recent_sessions %}
                    <tr>
                        <td>{{ session.session_name or 'Session ' + session.session_id|string }}</td>
                        <td>{{ session.device_name }}</td>
                        <td>{{ session.start_time.strftime('%Y-%m-%d %H:%M') }}</td>
                        <td>
                            {% if session.end_time %}
                                {{ ((session.end_time - session.start_time).total_seconds()/3600)|round(2) }}h
                            {% else %}
                                Active
                            {% endif %}
                        </td>
                        <td>{{ "%.3f"|format(session.total_energy_kwh or 0) }} kWh</td>
                        <td>Rp {{ "{:,.0f}".format(session.energy_cost or 0) }}</td>
                        <td>
                            <span class="status-badge status-{{ session.status|lower }}">
                                {{ session.status }}
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Quick Actions -->
    <div class="quick-actions">
        <h2><i class="fas fa-rocket"></i> Quick Actions</h2>
        <div class="action-buttons">
            <a href="{{ url_for('monitoring') }}" class="action-btn-large">
                <i class="fas fa-play-circle"></i>
                <span>Start New Monitoring</span>
            </a>
            <a href="{{ url_for('devices') }}" class="action-btn-large">
                <i class="fas fa-plus-circle"></i>
                <span>Add New Device</span>
            </a>
            <a href="{{ url_for('reports') }}" class="action-btn-large">
                <i class="fas fa-chart-pie"></i>
                <span>View Reports</span>
            </a>
            <a href="{{ url_for('logs') }}" class="action-btn-large">
                <i class="fas fa-file-alt"></i>
                <span>View All Logs</span>
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}